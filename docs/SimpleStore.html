<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>SimpleStore</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_SimpleStore.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/SimpleStore.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">simple-store-3.0.0: An atomic, durable data store</p></div><div id="content"><div id="module-header"><table class="info"><tr><th>Copyright</th><td>Plow Technologies LLC</td></tr><tr><th>Maintainer</th><td>Scott Murphy</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">SimpleStore</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>SimpleStore consists of a very small api for generating serialization storage that is robust to
power pulls.  It also has write control locking.</p><p>SimpleStore works by maintaining a set of 4 files as checkpoints.
It cycles through these, writing a new one each time.  This
means you always have a backup that is closed on disk.</p></div></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><a href="#v:closeSimpleStore">closeSimpleStore</a> :: a -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><a href="#v:createCheckpoint">createCheckpoint</a> :: <a href="../cereal-0.5.2.0/Data-Serialize.html#t:Serialize">Serialize</a> st =&gt; <a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> ())</li><li class="src short"><a href="#v:createCheckpointImmediate">createCheckpointImmediate</a> :: <a href="../cereal-0.5.2.0/Data-Serialize.html#t:Serialize">Serialize</a> st =&gt; <a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> ())</li><li class="src short"><a href="#v:getSimpleStore">getSimpleStore</a> :: <a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> st</li><li class="src short"><a href="#v:makeSimpleStore">makeSimpleStore</a> :: <a href="../cereal-0.5.2.0/Data-Serialize.html#t:Serialize">Serialize</a> st =&gt; <a href="../system-filepath-0.4.13.4/Filesystem-Path.html#t:FilePath">FilePath</a> -&gt; st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> (<a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st))</li><li class="src short"><a href="#v:modifySimpleStore">modifySimpleStore</a> :: <a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st -&gt; (st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> st) -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> ())</li><li class="src short"><a href="#v:openSimpleStore">openSimpleStore</a> :: <a href="../cereal-0.5.2.0/Data-Serialize.html#t:Serialize">Serialize</a> st =&gt; <a href="../system-filepath-0.4.13.4/Filesystem-Path.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> (<a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st))</li><li class="src short"><a href="#v:attemptOpenDefault">attemptOpenDefault</a> :: <a href="../cereal-0.5.2.0/Data-Serialize.html#t:Serialize">Serialize</a> st =&gt; <a href="../system-filepath-0.4.13.4/Filesystem-Path.html#t:FilePath">FilePath</a> -&gt; st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> (<a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st))</li><li class="src short"><a href="#v:putSimpleStore">putSimpleStore</a> :: <a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st -&gt; st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> ()</li><li class="src short"><span class="keyword">data</span> <a href="#t:SimpleStore">SimpleStore</a> st</li><li class="src short"><span class="keyword">data</span> <a href="#t:StoreError">StoreError</a><ul class="subs"><li>= <a href="#v:StoreAlreadyOpen">StoreAlreadyOpen</a></li><li>| <a href="#v:StoreClosed">StoreClosed</a></li><li>| <a href="#v:StoreLocked">StoreLocked</a></li><li>| <a href="#v:StoreFolderNotFound">StoreFolderNotFound</a></li><li>| <a href="#v:StoreFileNotFound">StoreFileNotFound</a></li><li>| <a href="#v:NoStoreFilesInPath">NoStoreFilesInPath</a></li><li>| <a href="#v:StoreCheckpointNotFound">StoreCheckpointNotFound</a></li><li>| <a href="#v:StoreIOError">StoreIOError</a> <a href="../base-4.8.2.0/Data-String.html#t:String">String</a></li></ul></li></ul></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a name="v:closeSimpleStore" class="def">closeSimpleStore</a> :: a -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> () <a href="src/SimpleStore-IO.html#closeSimpleStore" class="link">Source</a></p><div class="doc"><p>Release the file lock and close the handle to the file allowing another processes to open
 the store</p></div></div><div class="top"><p class="src"><a name="v:createCheckpoint" class="def">createCheckpoint</a> :: <a href="../cereal-0.5.2.0/Data-Serialize.html#t:Serialize">Serialize</a> st =&gt; <a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> ()) <a href="src/SimpleStore-IO.html#createCheckpoint" class="link">Source</a></p><div class="doc"><p>Write the current store to disk in the given folder</p></div></div><div class="top"><p class="src"><a name="v:createCheckpointImmediate" class="def">createCheckpointImmediate</a> :: <a href="../cereal-0.5.2.0/Data-Serialize.html#t:Serialize">Serialize</a> st =&gt; <a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> ()) <a href="src/SimpleStore-IO.html#createCheckpointImmediate" class="link">Source</a></p><div class="doc"><p>Write the current store to disk in the given folder immediately</p></div></div><div class="top"><p class="src"><a name="v:getSimpleStore" class="def">getSimpleStore</a> :: <a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> st <a href="src/SimpleStore-IO.html#getSimpleStore" class="link">Source</a></p><div class="doc"><p>Get the current value of the store</p></div></div><div class="top"><p class="src"><a name="v:makeSimpleStore" class="def">makeSimpleStore</a> :: <a href="../cereal-0.5.2.0/Data-Serialize.html#t:Serialize">Serialize</a> st =&gt; <a href="../system-filepath-0.4.13.4/Filesystem-Path.html#t:FilePath">FilePath</a> -&gt; st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> (<a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st)) <a href="src/SimpleStore-IO.html#makeSimpleStore" class="link">Source</a></p><div class="doc"><p>Initialize a simple store from a given filepath and state.
 The filepath should just be to the directory you want the state created in
 as in &quot;state&quot;</p></div></div><div class="top"><p class="src"><a name="v:modifySimpleStore" class="def">modifySimpleStore</a> :: <a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st -&gt; (st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> st) -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> ()) <a href="src/SimpleStore-IO.html#modifySimpleStore" class="link">Source</a></p><div class="doc"><p>Run a function against the state and put the result into the state
 This does not write the store to disk</p></div></div><div class="top"><p class="src"><a name="v:openSimpleStore" class="def">openSimpleStore</a> :: <a href="../cereal-0.5.2.0/Data-Serialize.html#t:Serialize">Serialize</a> st =&gt; <a href="../system-filepath-0.4.13.4/Filesystem-Path.html#t:FilePath">FilePath</a> -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> (<a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st)) <a href="src/SimpleStore-IO.html#openSimpleStore" class="link">Source</a></p><div class="doc"><p>Open a simple store from a filepath reading in the newest most valid store
 important to the operation of this is the last.touch file.
 this file tells openSimpleStore what to try and open first.
 it is plain text encoded and updated on every checkpoint.</p></div></div><div class="top"><p class="src"><a name="v:attemptOpenDefault" class="def">attemptOpenDefault</a> :: <a href="../cereal-0.5.2.0/Data-Serialize.html#t:Serialize">Serialize</a> st =&gt; <a href="../system-filepath-0.4.13.4/Filesystem-Path.html#t:FilePath">FilePath</a> -&gt; st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> (<a href="../base-4.8.2.0/Data-Either.html#t:Either">Either</a> <a href="SimpleStore.html#t:StoreError">StoreError</a> (<a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st)) <a href="src/SimpleStore-IO.html#attemptOpenDefault" class="link">Source</a></p><div class="doc"><p>Attempt to open a store. If the store doesn't it exist it will create the store in the filepath given
 with makeSimpleStore.</p></div></div><div class="top"><p class="src"><a name="v:putSimpleStore" class="def">putSimpleStore</a> :: <a href="SimpleStore.html#t:SimpleStore">SimpleStore</a> st -&gt; st -&gt; <a href="../base-4.8.2.0/System-IO.html#t:IO">IO</a> () <a href="src/SimpleStore-IO.html#putSimpleStore" class="link">Source</a></p><div class="doc"><p>Put a new value into a simple store with the lock</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:SimpleStore" class="def">SimpleStore</a> st <a href="src/SimpleStore-Types.html#SimpleStore" class="link">Source</a></p><div class="doc"><p>A SimpleStore will be created at the directory given
 The storeDir is a filepath to the current active state's backup.
 The store state is the in-memory representation of the item in storage.
 The lock is engaged on modify and writes.
 The checkpoint version says what to increment the next backup to.</p></div></div><div class="top"><p class="src"><span class="keyword">data</span> <a name="t:StoreError" class="def">StoreError</a> <a href="src/SimpleStore-Types.html#StoreError" class="link">Source</a></p><div class="doc"><p>All error types for SimpleStore</p></div><div class="subs constructors"><p class="caption">Constructors</p><table><tr><td class="src"><a name="v:StoreAlreadyOpen" class="def">StoreAlreadyOpen</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:StoreClosed" class="def">StoreClosed</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:StoreLocked" class="def">StoreLocked</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:StoreFolderNotFound" class="def">StoreFolderNotFound</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:StoreFileNotFound" class="def">StoreFileNotFound</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:NoStoreFilesInPath" class="def">NoStoreFilesInPath</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:StoreCheckpointNotFound" class="def">StoreCheckpointNotFound</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a name="v:StoreIOError" class="def">StoreIOError</a> <a href="../base-4.8.2.0/Data-String.html#t:String">String</a></td><td class="doc empty">&nbsp;</td></tr></table></div><div class="subs instances"><p id="control.i:StoreError" class="caption collapser" onclick="toggleSection('i:StoreError')">Instances</p><div id="section.i:StoreError" class="show"><table><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Data-Eq.html#t:Eq">Eq</a> <a href="SimpleStore.html#t:StoreError">StoreError</a></span> <a href="src/SimpleStore-Types.html#line-52" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src clearfix"><span class="inst-left"><a href="../base-4.8.2.0/Text-Show.html#t:Show">Show</a> <a href="SimpleStore.html#t:StoreError">StoreError</a></span> <a href="src/SimpleStore-Types.html#line-52" class="link">Source</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.16.1</p></div></body></html>